name: Test (Py3.12, minimal)

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v4

      - name: Ensure python3.12 exists
        shell: bash
        run: |
          command -v python3.12 >/dev/null || { echo "python3.12 not found"; exit 1; }
          python3.12 -V

      - name: Install package and run tests (reuse system packages)
        shell: bash
        run: |
          set -euo pipefail
          python3.12 -m venv .venv --system-site-packages
          source .venv/bin/activate

          # small bootstrap only; heavy GPU libs are reused from system site-packages
          python -m pip install -U pip setuptools wheel

          # install your package + test extras; pip builds a wheel under the hood
          python -m pip install --no-build-isolation ".[test]"

          # run tests
          pytest -q
